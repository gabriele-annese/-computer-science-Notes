
# Malware.stage0.exe
## Static Analysis

### Hashes

| type    | hash                                                             |
| ------- | ---------------------------------------------------------------- |
| MD5     | 6d8895c63a77ebe5e49b656bdefdb822                                 |
| SHA-1   | de8fb0deb6a0ac1f621950270f0ee312357401d7                         |
| SHA-256 | fca62097b364b2f0338c5e4c5bac86134cedffa4f8ddf27ee9901734128952e3 |

### Virus Total

[More information about `Malware.stage0.exe.malz`](https://www.virustotal.com/gui/file/fca62097b364b2f0338c5e4c5bac86134cedffa4f8ddf27ee9901734128952e3)

### Architecture
The architecture of Malware.stage0 is `x86 - 32 bit`.
![[Pasted image 20241214125700.png]]

### Imports

| Function            | x   | Address    | RVA        | Size          | Category       | Technique | Trigger           | Description | Module |              |
| ------------------- | --- | ---------- | ---------- | ------------- | -------------- | --------- | ----------------- | ----------- | ------ | ------------ |
| GetCurrentProcessId | x   | 0x0001B2E4 | 0x0001B2E4 | 544 (0x0220)  | reconnaissance | T1057     | Process Discovery | implicit    | -      | KERNEL32.dll |
| VirtualAlloc        | x   | 0x0001B430 | 0x0001B430 | 1460 (0x05B4) | memory         | T1055     | Process Injection | implicit    | -      | KERNEL32.dll |
| VirtualProtect      | x   | 0x0001B44E | 0x0001B44E | 1469 (0x05BD) | memory         | T1055     | Process Injection | implicit    | -      | KERNEL32.dll |
| VirtualQuery        | x   | 0x0001B460 | 0x0001B460 | 1472 (0x05C0) | memory         | T1055     | Process Injection | implicit    | -      | KERNEL32.dll |
| GetCurrentProcess   | x   | 0x0001B2D0 | 0x0001B2D0 | 543 (0x021F)  | execution      | T1057     | Process Discovery | implicit    | -      | KERNEL32.dll |
| GetCurrentThreadId  | x   | 0x0001B2FA | 0x0001B2FA | 548 (0x0224)  | execution      | T1057     | Process Discovery | implicit    | -      | KERNEL32.dll |
| TerminateProcess    | X   | 0x0001B3F2 | 0x0001B3F2 | 1401 (0x0579) | execution      | -         | -                 | implicit    | -      | KERNEL32.dll |

### Packed
No the malware are not packed
### Strings

![[Pasted image 20241214131022.png]]

```
GetCurrentProcessId
GetCurrentProcessId
GetCurrentProcessId
inet_ntop
VirtualAlloc
VirtualProtect
VirtualQuery
VirtualProtect
VirtualQuery
WriteProcessMemory
VirtualAllocEx
GetCurrentProcess
GetCurrentProcess
TerminateProcess
GetCurrentThreadId
GetCurrentProcess
GetCurrentThreadId
TerminateProcess
GetCurrentProcess
TerminateProcess
GetCurrentThreadId
CreateProcess
SuspendThread
OpenProcess
CreateRemoteThread
```



### Disassembly 
Execution of `werft.exe`
![[Pasted image 20241214191902.png]]
The `werft.exe` start with the PID of `WerFault` process in this case 6224
![[Pasted image 20241214192026.png]]

Analyzing the assembly code we can view the `werft.exe` inject reverse shell into memory of WerFault process 
![[Pasted image 20241214193158.png]]

- [OpenProcess](https://learn.microsoft.com/en-us/windows/win32/api/processthreadsapi/nf-processthreadsapi-openprocess)
- [VirtualAllocEx](https://learn.microsoft.com/it-it/windows/win32/api/memoryapi/nf-memoryapi-virtualallocex)
- [WriteProcessMemory](https://learn.microsoft.com/en-us/windows/win32/api/memoryapi/nf-memoryapi-writeprocessmemory)
- [CreateRemoteThread](https://learn.microsoft.com/en-us/windows/win32/api/processthreadsapi/nf-processthreadsapi-createremotethread)

## Basic Dynamic Analysis

### Host Base signature
The malware create under the `C:\Users\Public` path the `werflt.exe`

![[Pasted image 20241214133954.png]]

### Network Base signature

![[Pasted image 20241214134227.png]]

If set a listener on my local machine
`nc -nlvp 8443` the connection is established
![[Pasted image 20241214140037.png]]
 i think the malware suing the `werflt.exe` to inject a reverse shell 
