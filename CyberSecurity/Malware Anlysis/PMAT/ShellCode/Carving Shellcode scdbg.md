# Intro 
Malware used in this section: `PMAT-labs/labs/3-2.WhatTheShell-ShellcodeAnalysis/CarveFromText`


## Code Analysis
The source code of this shellcode its pretty simple. The is a payload and the win api call to create and execute the payload as a process.
![[Pasted image 20250119230406.png]]

No try to decode a pyaload. First insert the payload in a text file.
![[Pasted image 20250119230621.png]]

And now create a simple python script to decode this.
```python
with open("payload.txt", "r") as p:
    hex_string = p.read().replace("0x","").replace("byte[] rsrc = new byte[464] {", "").replace("};", "").replace(",","")
    hex_encode = hex_string.encode()


with open("out.bin","wb") as out:
    out.write(hex_encode)
```

The out.bi file:
![[Pasted image 20250119231511.png]]
Now to analyze this byte we can use `scdbg`. 

> `scdbg` is a shellcode analysis when run it will display to the user all of the Windows API the shellcode attempts to call.

```bash
scdbg.exe -f .\out.bin -s -1
```

![[Pasted image 20250119231821.png]]As we can see the sheell code try to call the `burn.ec2-13-7-109-121-ubuntu-2004.local` on port `443` so in https i suppose, get the buffer, create a file `javaupdate.exe` and write the buffer in, finally execute the `javaupdate.exe` file.